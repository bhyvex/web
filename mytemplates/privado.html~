{% extends 'base.html' %}
{% block titulo %}Bienvenido{% endblock %}
{% block encabezado %} 

<script src="{{STATIC_URL}}js/bootstrap.file-input.js"></script>
<script src="{{STATIC_URL}}js/jquery.tablesorter.js"></script>
<script src="{{STATIC_URL}}js/jquery.tablesorter.widgets.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/pdf.js"></script>

<div class="row">
	<div class="col-xs-6 col-sm-4 col-md-offset-8">
		<div class="col-md-1">
			<form id='form' method='post' enctype='multipart/form-data' action=''>{% csrf_token %}
				<input class="btn-primary" type="file" id="files" autofocus="" required="" placeholder="file" name="file" title="+ add file"> 
			</form>
		</div>
		<div class="col-md-1 col-md-offset-2"><button id='folder' type="button" class="btn btn-primary">Create new folder</button></div>
	</div>
</div>

<script type="text/javascript">
	document.getElementById("files").onchange = function() {
		document.getElementById("form").submit();
	}
</script>

<script type="text/javascript">
	$(document).ready(function(){$('input[type=file]').bootstrapFileInput();});
</script>

<script type="text/javascript">
	document.getElementById("folder").onclick = function() {
		var foldername = prompt("Enter the name of the new folder : ", "folder name");
		if(foldername && foldername != ""){
			document.location.href = '/newfolder/'+foldername;
		}
	}
</script>

{% endblock %}
{% block contenido %}



<div>
{% if pathlist %}
	<a href="/">Stacksync</a>
{% endif %}
{% for item in pathlist %}
	{% if forloop.last %}
		/ {{item.nombre}}
	{% else %}
		/ <a href="/focus/{{item.file_id}}">{{item.nombre}}</a>
	{% endif %}
{% endfor %}
</div>

{% load sort_extras %}

<div >	

	 <table id="myTable" class="tablesorter">
		<thead>
			<tr>
				<th>
					<a href="#">Name</a>
				</th>
				<th>
					<a href="#">Size</a>
				</th>
				<th>
					<a href="#">Last modified</a>
				</th>
			</tr>
		</thead>
		<tbody>
			{% for dato in archivos  %}
			
				<tr>	
					{% if dato.is_folder %}
						<td class="showContext2" id="{{dato.file_id}}">
						       <a class="file" href="/focus/{{dato.file_id}}"><span class="glyphicon glyphicon-folder-close"></span> {{dato.nombre|title}}</a>
						</td>
						<td class="showContext2" id="{{dato.file_id}}">--</td>
						<td class="showContext2" id="{{dato.file_id}}"> {{dato.fecha|title}} </td>
					{% else %}
						<td class="showContext" id="{{dato.file_id}}">
						{% if dato.mimetype|slice:":5" == "image" %}
							<a href="/img/{{dato.file_id}}" ><span class="glyphicon glyphicon-list-alt" ></span> {{dato.nombre|title}}</a>
						{% elif dato.mimetype == "application/pdf" %}
							<a class="file" href="/pdf/{{dato.file_id}}"><span class="glyphicon glyphicon-list-alt"></span> {{dato.nombre|title}}</a>
						{% else %}
							<a href="#" ><span class="glyphicon glyphicon-list-alt" ></span> {{dato.nombre|title}}</a>
						{% endif %}
						</td>
							<td class="showContext" id="{{dato.file_id}}"> {{dato.tamano}} bytes</td>
							<td class="showContext" id="{{dato.file_id}}"> {{dato.fecha|title}} </td>
					{% endif %}
				</tr>
		  						
			{% endfor %}
		
		</tbody>
	</table>


<script type="text/javascript">
	$(function() {
		$.extend($.tablesorter.themes.bootstrap, {
		// these classes are added to the table. To see other table classes available,
		
		table : 'table table-striped table-hover',	  
		});
		// call the tablesorter plugin and apply the uitheme widget
		$("table").tablesorter({
			// this will apply the bootstrap theme if "uitheme" widget is included
			// the widgetOptions.uitheme is no longer required to be set
			theme : "bootstrap",
			widthFixed: true,
			// widget code contained in the jquery.tablesorter.widgets.js file
			// use the zebra stripe widget if you plan on hiding any rows (filter widget)
			widgets : [ "uitheme", "zebra" ],
			widgetOptions : {
			// using the default zebra striping class name, so it actually isn't included in the theme variable above
			// this is ONLY needed for bootstrap theming if you are using the filter widget, because rows are hidden

			// reset filters button
			filter_reset : ".reset"

			// set the uitheme widget to use the bootstrap theme class names
			// this is no longer required, if theme is set
			// ,uitheme : "bootstrap"
	  	}
	  	})
	});
</script>
<script type="text/javascript">
	$(function(){
  		$("#myTable").tablesorter();
	});
</script>

<script type="text/javascript">
         // DOM Ready
        $(function() {

            // Binding a click event
            // From jQuery v.1.7.0 use .on() instead of .bind()
            $('.popup-opener').on('click', function(e) {
		
                // Prevents the default action to be triggered. 
                e.preventDefault();
		var rand = Math.round(Math.random() * 6);
		document.getElementById("imagepop").src='media/temporaryfile?dummy='+rand;
		var file_id = $(this).attr('id')
		
                // Triggering bPopup when click event is fired
                $('#element_to_pop_up').bPopup();
            });
        });
</script>

</div>

<script type="text/javascript">
  $(document).ready(function () {
    $('td.showContext').contextMenu('myMenu1', {
      bindings: {
        'delete': function (t) {
          document.location.href = '/delete/'+t.id;
        },
        'download': function (t) {
          document.location.href = '/download/'+t.id;
        },
	'rename': function (t) {
          var newName = prompt("Enter the new name : ", "new name");
        },
	'move': function (t) {
	  var str = "root";
          var popy = window.open('/move/'+str,'popup_form','location=no,menubar=no,status=no,top=50%,left=50%,height=550,width=750');
        }
      }
    });
     $('td.showContext2').contextMenu('myMenu2', {
      bindings: {
        'delete': function (t) {
          document.location.href = '/delete/'+t.id;
        },
	'rename': function (t) {
          var newName = prompt("Enter the new name : ", "new name");
        },
	'move': function (t) {
          var str = "root";
          var popy = window.open('/move/'+str,'popup_form','location=no,menubar=no,status=no,top=50%,left=50%,height=550,width=750');
        }
      }
    });
  });
</script>

<div class="contextMenu" id="myMenu1">
	<ul>
    		<li id="delete"><span class="glyphicon glyphicon-remove" ></span> Delete</li>
    		<li id="download"><span class="glyphicon glyphicon-cloud-download" ></span> Download</li>
		<li id="rename"><span class="glyphicon glyphicon-pencil" ></span> Rename</li>
		<li id="move"><span class="glyphicon glyphicon-folder-open" ></span> Move</li>
    	</ul>
</div>

<div class="contextMenu" id="myMenu2">
	<ul>
    		<li id="delete"><span class="glyphicon glyphicon-remove" ></span> Delete</li>
		<li id="rename"><span class="glyphicon glyphicon-pencil" ></span> Rename</li>
		<li id="move"><span class="glyphicon glyphicon-folder-open" ></span> Move</li>
    	</ul>
</div>

{% endblock %}
